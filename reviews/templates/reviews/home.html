{% extends "reviews/base.html" %}
{% block content %}
    {% load static %}



<header>
   
    <div id="bar" style="text-align: center;">
        <h1>Every Stay Has a <span>Story</span></h1>
        <p>Share your journey, read real reviews, and see the world through travelers‚Äô eyes</p>
<div id="sbar"><input  type="text" id="searchInput" placeholder="Search reviews..." />
</div>
<br>
<button id="search">click to search</button>
</div>

</header>



<div id="cards" class="cards">
{% for review in reviews %}
<div class="review-card">
    <img src="{{ review.images.first.image.url }}" alt="review img">

    <div class="card-body">
        <h3 class="card-title">{{ review.title }}</h3>

       <a href="{% url 'reviews:place_reviews' review.place.id %}"><p class="place-name">üìç {{ review.place }}</p></a>

        <p class="card-description">{{ review.description|truncatewords:20 }}</p>
<h4 style="color: white;"><a href="{% url 'reviews:user_reviews' review.user.id %}" >{{ review.user.username }} </a> {% if user.is_authenticated %}<img src="{{ review.user.profile.avatar.url }}" alt="" class="avatar-img">{% endif %} </h4> 
        <div class="card-footer">
            <div class="stars">
                {% for i in "12345" %}
                    {% if forloop.counter <= review.rating %}
                        <span class="star filled">‚òÖ</span>
                    {% else %}
                        <span class="star">‚òÜ</span>
                    {% endif %}
                {% endfor %}
            </div>

            <a href="{% url 'reviews:review_detail' review.id %}" class="details-btn">Show more</a>
        </div>
    </div>
</div>
{% endfor %}
</div>

<div id="profilePopup" class="popup-overlay">
  <div class="popup-content">
    <span class="close-btn" onclick="togglePopup()">&times;</span>
<div>
    <h3>Edit Profile</h3>
    <form method="post" action="{% url 'reviews:edit_profile' %}" enctype="multipart/form-data">
      {% csrf_token %}
      <div style="text-align: center;">
        <img src="{{ request.user.profile.avatar.url }}" alt="Avatar" class="avatar-img" >
      </div>

      {{ form.as_p }}

      <button type="submit">Save</button>
    </form>
  </div>
  </div>
</div>
<div class="pagination">
    {% if reviews.has_previous %}
        <a href="?page={{ reviews.previous_page_number }}">Pre</a>
    {% endif %}
    <span>Page {{ reviews.number }} From {{ reviews.paginator.num_pages }}</span>
    {% if reviews.has_next %}
        <a href="?page={{ reviews.next_page_number }}">Next</a>
    {% endif %}
</div>
       

<script>
const searchInput= document.getElementById('searchInput');
const cards= document.getElementById('cards');
const reviewCard= document.getElementsByClassName('review-card');


searchInput.addEventListener('keyup', function() {

    const filter = searchInput.value.toLowerCase();
     
    for(let i=0;i< reviewCard.length; i++){
     
        const tittle =reviewCard[i].querySelector('.card-title').textContent.toLowerCase();
        const description =reviewCard[i].querySelector('.card-description').textContent.toLowerCase();
        const place =reviewCard[i].querySelector('.place-name').textContent.toLowerCase();
 if(tittle.includes(filter) || description.includes(filter) || place.includes(filter)){
    reviewCard[i].style.display=''
 }else{
        reviewCard[i].style.display='none'

 }
    }

});

/* the search bar toggle */
const bar =document.getElementById('sbar');
const search = document.getElementById('search')
search.addEventListener('click',function(){
    if(bar.style.display =='none'){
        bar.style.display= 'block'
    }else{
       bar.style.display='none' 
    }
})


</script>
{% endblock %}

